<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>长视频智能分析助手</title>
    <link rel="stylesheet" th:href="@{/style.css}">
</head>
<body>
    <div class="container">
        <header>
            <h1>🎬 长视频智能分析助手</h1>
            <p class="subtitle">上传字幕文件，AI 帮你高效学习</p>
        </header>

        <div class="error" th:if="${error}">
            <p th:text="${error}"></p>
        </div>

        <section class="upload-section">
            <h2>📁 上传字幕文件</h2>
            <form action="/upload" method="post" enctype="multipart/form-data">
                <div class="file-input-wrapper">
                    <input type="file" name="file" accept=".txt,.srt">
                    <span>支持 .txt .srt 格式</span>
                </div>
                <div class="button-group">
                    <button type="submit" class="btn btn-primary">上传文件</button>
                    <button type="submit" name="useSample" value="true" class="btn btn-secondary">
                        使用示例字幕
                    </button>
                </div>
            </form>
        </section>

        <section class="status-section" th:if="${subtitleLoaded}">
            <div class="status-card">
                <span class="label">当前字幕：</span>
                <span class="filename" th:text="${fileName}">-</span>
                <span class="char-count" th:text="'(' + ${charCount} + ' 字符)'">(- 字符)</span>
            </div>
        </section>

        <!-- 操作区域 -->
        <section class="action-section" th:if="${subtitleLoaded}">
            <h2>📊 快捷操作</h2>
            <div class="button-group">
                <form action="/summarize" method="post" style="display:inline">
                    <input type="hidden" name="subtitleContent" th:value="${subtitleContent}">
                    <button type="submit" class="btn btn-primary">生成全局总结</button>
                </form>
                <form action="/extract" method="post" style="display:inline">
                    <input type="hidden" name="subtitleContent" th:value="${subtitleContent}">
                    <button type="submit" class="btn btn-secondary">提取知识点</button>
                </form>
            </div>
        </section>

        <!-- 智能问答区域 -->
        <section class="smart-ask-section" th:if="${subtitleLoaded}">
            <h2>🤖 智能问答 (自动识别意图)</h2>
            <p class="hint">输入任意问题，AI 会自动判断你的意图（总结/问答/知识点/金句/搜索）</p>
            <form action="/ask" method="post">
                <input type="hidden" name="subtitleContent" th:value="${subtitleContent}">
                <div class="chat-input-wrapper">
                    <textarea name="question" placeholder="例如：总结一下这个视频 / 有哪些金句 / 哪里提到了 Transformer" rows="3"
                              th:text="${smartQuestion}"></textarea>
                </div>
                <div class="option-group">
                    <label class="checkbox-label">
                        <input type="checkbox" name="debug" value="true">
                        显示调试信息（意图分类结果）
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">智能回答</button>
            </form>
        </section>

        <!-- 智能问答结果 -->
        <section class="result-section" th:if="${smartAnswer}">
            <h2>🎯 智能回答</h2>
            <div class="result-card">
                <p class="question-preview" th:if="${smartQuestion}">
                    <strong>问题：</strong><span th:text="${smartQuestion}"></span>
                </p>
                <div class="debug-info" th:if="${debugIntent}">
                    <span class="debug-badge">意图: <strong th:text="${debugIntent}">-</strong></span>
                    <span class="debug-badge">置信度: <strong th:text="${#numbers.formatDecimal(debugConfidence, 1, 2)}">-</strong></span>
                </div>
                <pre th:text="${smartAnswer}"></pre>
            </div>
        </section>

        <section class="result-section" th:if="${summary}">
            <h2>📝 视频总结</h2>
            <div class="result-card">
                <pre th:text="${summary}"></pre>
            </div>
        </section>

        <!-- 知识点时间线 -->
        <section class="timeline-section" th:if="${concepts}">
            <h2>📚 知识点时间线</h2>
            <div class="timeline">
                <div class="timeline-item" th:each="concept : ${concepts}">
                    <div class="timeline-time">
                        <span th:text="${concept.timestampFrom}">00:00:00</span>
                        <span class="time-arrow">→</span>
                        <span th:text="${concept.timestampTo}">00:00:12</span>
                    </div>
                    <div class="timeline-content">
                        <h3 class="concept-name" th:text="${concept.concept}">知识点名称</h3>
                        <p class="concept-desc" th:text="${concept.description}">知识点描述</p>
                    </div>
                </div>
            </div>
        </section>

        <!-- 问答区域 -->
        <section class="chat-section" th:if="${subtitleLoaded}">
            <h2>💬 问答对话</h2>
            <form action="/chat" method="post">
                <input type="hidden" name="subtitleContent" th:value="${subtitleContent}">
                <div class="chat-input-wrapper">
                    <textarea name="question" placeholder="输入你的问题..." rows="3"
                              th:text="${question}"></textarea>
                </div>
                <button type="submit" class="btn btn-primary">发送提问</button>
            </form>
        </section>

        <section class="result-section" th:if="${answer}">
            <h2>🤖 AI 回答</h2>
            <div class="result-card">
                <p class="question-preview" th:if="${question}">
                    <strong>问题：</strong><span th:text="${question}"></span>
                </p>
                <pre th:text="${answer}"></pre>
            </div>
        </section>

        <footer>
            <p>基于 Spring AI Alibaba | 学习项目</p>
        </footer>
    </div>
</body>
</html>
